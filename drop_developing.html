<!DOCTYPE html>
<html>
<head lang="en">
  <meta charset="UTF-8">
  <title></title>
  <script type="text/javascript" src="raphael-2.1.0-min.js"></script>
  <script type="text/javascript" src="qrcodesvg.js"></script>
  <script type="text/javascript" src="FileSaver.min.js"></script>
  <script type="text/javascript" src="canvas-toBlob.js"></script>

</head>
<body>
<div style="width: 1000px; margin: 100px auto auto;">
  <div style="width: 400px;height: 600px;float: left;padding-top: 20px;">
    <div id="drop_zone" style="border: 3px dashed #606c71; width: 360px; margin: 20px;height: 360px;">Drop files here</div>
    <output id="list" style="width: 360px; margin: 20px;height: 100px;">No File Added</output>
  </div>
  <div id="input_field" style="width: 560px;height: 560px;float: left;padding:20px;">
    <div style="display: block">content:</div>
    <textarea id="textarea" style="width: 560px;height: 500px; margin: auto;resize: none"></textarea>
    <button style="width: 565px;height: 40px;background-color: snow">Output SVG Files</button>
  </div>
  <div id="qrcode" style="width: 1000px;margin-top: 100px;margin-bottom: 100px;margin-left: auto;margin-right: auto;border: 1px solid #55aaaa"></div>
</div>

<script src="//code.jquery.com/jquery-1.11.3.min.js"></script>

<script>
  function drawAndDownload(inputstring) {

    var qrcodesvg   = new Qrcodesvg( inputstring, "qrcode", 250);
    qrcodesvg.draw();
    var outputText = document.getElementById("qrcode").innerHTML;

    var blob = new Blob([outputText], {type: "text/plain;charset=utf-8"});
    saveAs(blob, inputstring + ".svg");

//    alert(document.getElementById("svg"));
//    var svg = document.createElement("svg");
//    svg.height = "250";
//    svg.version = "1.1";
//    svg.width = "250";
//    svg.xmlns = "http://www.w3.org/2000/svg";
//    svg.style.overflow = "hidden";
//    svg.style.position = "relative";
//    svg.innerText = document.getElementById("qrcode").getElementsByTagName("svg")[0];
  }
  function handleFileSelect(evt) {
    evt.stopPropagation();
    evt.preventDefault();

    var files = evt.dataTransfer.files;

    var output = [];
    for (var i = 0, f; f = files[i]; i++) {
      output.push('<li><strong>', escape(f.name), '</strong> (', f.type || 'n/a', ') - ',
          f.size, ' bytes, last modified: ',
          f.lastModifiedDate ? f.lastModifiedDate.toLocaleDateString() : 'n/a',
          '</li>');
    }
    document.getElementById('list').innerHTML = '<ul>' + output.join('') + '</ul>';


    var file = files[0];
    var start = parseInt(0) || 0;
    var stop = file.size - 1;

    var reader = new FileReader();

    reader.onloadend = function(evt) {
      if (evt.target.readyState == FileReader.DONE) { // DONE == 2
        document.getElementById('textarea').textContent = evt.target.result;
      }

      var res = evt.target.result.split("\n");
      $.each(res, function(k){
//        alert(res[k]);
        drawAndDownload(res[k]);
      });
    };

    var blob = file.slice(start, stop + 1);
    reader.readAsBinaryString(blob);
  }

  function handleDragOver(evt) {
    evt.stopPropagation();
    evt.preventDefault();
    evt.dataTransfer.dropEffect = 'copy'; // Explicitly show this is a copy.
  }

  var dropZone = document.getElementById('drop_zone');
  dropZone.addEventListener('dragover', handleDragOver, false);
  dropZone.addEventListener('drop', handleFileSelect, false);
</script>

</body>
</html>